<!DOCTYPE html>
<html lang="en">
	<head>
	 <!--/*/ <th:block th:include="global :: head"></th:block> /*/-->
    <title>HomeKeep</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/global.css}">
    <script type="text/javascript" th:src="@{/js/messages.js}"></script>
	</head>
	<body>
		<header th:replace="global :: header"></header>
		<div class = "container">
			<div class = "row">
				<div class = "col-sm">
					<h2 class = "text-center"> Inbox </h2>

					<tablem class = "table-striped">
						<tr th:each = "u :${interlocutors}">
							<div>
			            		<td><a class = "h5" th:href = "@{/api/messages/inbox/{id}(id = ${u.getId()})}"><p th:text = "${u.getFirstname() + ' ' + u.getLastname()}"></p></a></td>
			            	</div>
			            </tr>
					</table>
				
				</div>
				<div class = "col-sm">
					
				    <div>
				    	<table>
				    		<h2 th:if= "${secondId != null and secondId != currentId}"  class = "text-center" th:text = "'Conversation with '+${recipient.getFirstname()}"></h2>	
							<tr th:each="message : ${conversation}">
								<div class = "container">
									
									<th>
										<td> <p class  ="h6" th:text = "${message.getOwner().getFirstname() + ' ' + message.getOwner().getLastname() + ': '}"></p></td>
						                <td> <p class = "h6" th:text="${message.content.get()}"></p></td>
						            	<td> <p class = "h6" th:text="'Date: ' + ${message.getDate()}"></p></td>
						            </th>
						            <th th:if = "${message.getBooking() != null}">
										<td><p class = "h6" th:text = "${message.getBooking().orElseThrow().getStatus()}"></p></td>
										<td th:if = "${(message.getBooking().orElseThrow().house.owner.id == currentId)}">
											<div th:if = "${message.getBooking().orElseThrow().status.PENDING}">
												<form id = "booking-form" method = "post" action = "@{/api/bookings/{id}(id = ${message.getBooking().orElseThrow().id})}">
													<input type = "text" id = "status" name = "status" value = "ACCEPTED" hidden>
													<button type = "Submit">Accept</button>
												</form>
												<button>Refuse</button>
											</div>
										</td>
									</th>
					            </div>
				            </tr>
				            
						</table>
				    </div>
				    <div th:unless="${secondId != null and secondId != currentId}">
				    	<h2 class = "text.center">Start a Conversation</h2>
				    </div>
				    <div  th:if="${secondId != null and secondId != currentId}">

						<form id="new-message" th:action="@{/api/messages/inbox/{id}(id = ${secondId})}" method = "post">
					        <div>
					        	<h2 class = "text-center" th:text = "'Send a message to '+${recipient.getFirstname()}"></h2>
					      		<input type = "hidden" id = "recipient" name = "recipient" th:value = ${secondId} >
					        	<input type = "text" id = "content" name = "content" required>
					            <button type="submit">Send</button>
					        </div>
				        </form>
				    </div>
				</div>
			</div>
		</div>
	</body>
</html>